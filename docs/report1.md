# ðŸ“„ **Phase 1 Completion Report â€“ Cloud RAG System**

## âœ… **Objective of Phase 1**

Set up the complete **skeleton architecture** and **AWS infrastructure foundation** required for a multi-Lambda, S3-driven RAG pipeline.

Phase 1 ensures all cloud components exist, are connected, and Lambdas can be triggered.

Phase 2 will implement actual logic (PDF â†’ text â†’ chunks â†’ embeddings â†’ RAG).

---

# 1. **Repository & Code Structure (Local)**

The codebase has been scaffolded with the following structure:

```
cloud-rag/
â”‚
â”œâ”€â”€ lambdas/
â”‚   â”œâ”€â”€ index_pdf/
â”‚   â”œâ”€â”€ chunk_embed/
â”‚   â”œâ”€â”€ query_rag/
â”‚   â””â”€â”€ gemini_llm/
â”‚
â””â”€â”€ utils/
```

* Each Lambda has its own folder.
* `utils/` will hold helpers (chunking, Bedrock client wrapper, S3 utilities).
* Git initialized (optional).

---

# 2. **AWS Resources Created**

## **2.1 S3 Buckets**

### âœ” `paper-pdfs-*`

For  **raw PDF uploads** .

Configured with S3 â†’ Lambda trigger.

### âœ” `paper-texts-*`

For **extracted text** generated by `IndexPdfLambda`.

### âœ” `paper-vectors-*` (Vector Bucket)

* Vector index: **`paper-chunks`**
* Configuration:
  * **dimension:** 256
  * **distance metric:** cosine
  * **non-filterable metadata:** `source_text`
  * filterable metadata is implicit (new AWS behavior)

This is the **vector database** for RAG.

---

## **2.2 Lambda Functions (4 total)**

All Lambdas use:

* Runtime: **Python 3.12**
* Execution role: **`rag-lambda-exec-role`**
* Stub handlers returning `"is alive"` for now

### Lambdas created:

1. **`IndexPdfLambda`**
   * Triggered automatically when a PDF is uploaded
   * Tested via S3 event + CloudWatch logs
2. **`ChunkAndEmbedLambda`**
   * Will receive extracted text and:
     * chunk â†’ embed (Bedrock Titan Embeddings V2) â†’ push to vector bucket
3. **`QueryRagLambda`**
   * Will embed user query â†’ perform vector search â†’ return top-k chunks
4. **`GeminiLambda`**
   * Will call Gemini API with (top-k chunks + question)
   * Will return final answer

All 4 deployed and tested from console.

---

## **2.3 IAM / Secrets / Model Access**

### âœ” Execution Role

**`rag-lambda-exec-role`**

Attached policies:

* `AWSLambdaBasicExecutionRole`
* `AmazonS3FullAccess`
* `AmazonBedrockFullAccess`

### âœ” Secrets Manager

Secret created:

```
gemini/api-key/dev
â†’ contains key: GEMINI_API_KEY
```

### âœ” Bedrock Model Access

* Bedrockâ€™s **Titan Text Embeddings V2** visible in Model Catalog
* Bedrock model-access page retired â†’ serverless models auto-enabled

Model ID:

```
amazon.titan-embed-text-v2:0
```

---

# 3. **Event Wiring & Validation**

### âœ” S3 â†’ Lambda Trigger

Bucket `paper-pdfs-*` triggers `IndexPdfLambda` on:

```
s3:ObjectCreated:*
```

### âœ” End-to-end test

Uploading a PDF:

* Fired the Lambda
* Logs visible in CloudWatch
* S3 event contained correct `{bucket, key}` payload

---
